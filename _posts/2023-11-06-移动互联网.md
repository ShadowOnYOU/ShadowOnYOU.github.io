---
layout: post
title: 移动互联网
categories: [cate1, cate2]
description: some word here
keywords: keyword1, keyword2
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---

# 移动互联网——架构设计视角

## 1. 课前

生活的小家电带有智能家居的类似功能

小程序流量稳定

人工智能备案

智能设备

## 2. 架构设计愿景

目标、要求、原则

### 2.1 目标

高可用性（自动化运维），高可扩展性（系统架构简单清晰，应用间低耦合，可以做水平扩展），低成本（增加服务的重用性，利用成熟的开源技术，利用虚拟化技术），多快好省（构建超大型电商交易平台）

### 2.2 质量要求

![截屏2023-11-06 下午7.08.28](https://github.com/ShadowOnYOU/images/blob/main/test202311061908100.png?raw=true)

### 2.3 总体架构原则

![截屏2023-11-06 下午7.09.27](https://github.com/ShadowOnYOU/images/blob/main/test202311061909991.png?raw=true)

### 2.4 整体架构设计

关系：业务/应用&&数据/技术

原则：解耦，拆分，抽象，集成，复用，治理

**整体横向分层抽象，局部纵向贯穿分解**

美团：

![截屏2023-11-06 下午7.13.12](https://github.com/ShadowOnYOU/images/blob/main/test202311061913915.png?raw=true)

阿里：

![截屏2023-11-06 下午7.14.35](https://github.com/ShadowOnYOU/images/blob/main/test202311061914417.png?raw=true)

#### 业务架构

设计原则：

1. 业务平台化：相互独立，如交易平台，仓储平台等；基础业务下沉，可复用。如用户、商品等。
2. 核心业务、非核心业务分离：分离，核心业务精简，非核心业务多样化
3. 区分主流程、辅流程：运行时有限保证主流程的顺利完成，辅流程可以采用后台异步的方式。
4. 隔离不同类型的业务：要有限保证高可用性，让用户快速下单

基础业务下沉：

![截屏2023-11-06 下午7.37.41](https://github.com/ShadowOnYOU/images/blob/main/test202311061937387.png?raw=true)

#### 

## 3. 架构设计视角

业务，应用，数据，技术

#### 应用架构

原则：

1. 稳定性原则
   1. 一切以稳定为中心
   2. 架构尽可能简单、清晰
   3. 不过度设计
2. 解耦/拆分
   1. 稳定部分与易变部分分离
   2. 核心业务与非核心业务分离
   3. 电商主流程与辅流程分离
   4. 应用与数据分离
   5. 服务与实现细节分离
3. 抽象化
   1. 应用抽象化
   2. 数据库抽象化：应用只依赖逻辑数据库，不需要关心物理库的位置和分片
   3. 服务器抽象化
4. 松耦合
   1. 跨域调用异步化：不同业务之间尽量异步解耦
   2. 非核心业务尽量异步化：核心，非核心业务之间尽量异步解欧
   3. 必须同步调用时设置超时时间和任务队列长度
5. 容错设计
   1. 服务自治
   2. 集群容错
   3. 多机房容灾

![截屏2023-11-06 下午7.47.42](https://github.com/ShadowOnYOU/images/blob/main/test202311061947547.png?raw=true)

#### 数据架构

正常经营的数据。如何进行数据的处理（例如大数据分析）？

#### 技术架构

架构分解原则：

![截屏2023-11-06 下午7.53.43](https://github.com/ShadowOnYOU/images/blob/main/test202311061953130.png?raw=true)

依赖原则：

1. 依赖稳定部分

2. 跨域弱依赖

3. 基本服务依赖

4. 非功能性服务依赖

5. 平台服务依赖

6. 核心服务依赖

   ![截屏2023-11-06 下午7.59.48](https://github.com/ShadowOnYOU/images/blob/main/test202311061959392.png?raw=true)

## 4. 不晓得是啥

数据架构：

![截屏2023-11-06 下午8.37.13](https://github.com/ShadowOnYOU/images/blob/main/test202311062037207.png?raw=true)

1. 使用缓存改善网站性能
2. 使用应用服务器集群改善网站的并发处理能力
3. 数据库的读写分离
4. 使用反向代理和CDN加速网站响应
   1. 反向代理是指在客户端和服务器之间插入一个位于服务器端的代理服务器，客户端的请求先发送到代理服务器，然后由代理服务器转发到实际的服务器。反向代理服务器可以缓存静态内容，并且可以根据各种算法和策略来分配请求到多个后端服务器，从而实现负载均衡。当客户端发送请求时，反向代理会根据缓存情况和负载均衡策略来选择最合适的服务器响应请求，这样可以减轻后端服务器的负载，提高响应速度。
   2. CDN是一种分布式网络架构，利用位于全球各地的边缘节点来缓存和提供静态内容。当用户请求访问一个网站时，CDN会根据用户的地理位置，将内容从最近的边缘节点提供给用户，减少了数据传输的距离和时间。CDN还可以通过缓存内容、并行传输和智能路由等技术来提高网站的访问速度和性能。
5. 使用分布式文件系统和分布式数据库系统



高可用

1. 负载均衡
   1. 在第四层和第七层做负载均衡
   2. 算法：
      1. 轮询
      2. 带权重的轮询
      3. ip_hash
2. 隔离
   1. 做各种层面的隔离，避免出错的连锁反应
3. 限流
4. 降级
5. 超时与重试机制
   1. 加载很长时间不做出反馈
6. 回滚
7. 压测和预案



高并发

1. 应用级缓存
2. HTTP缓存
   1. 客户端发送一个HTTP请求到服务器。
   2. 服务器返回HTTP响应，其中包含与请求相关的数据。
   3. 客户端接收到响应后，可以将该响应存储在本地缓存中。
   4. 当客户端再次需要相同的资源时，它可以通过检查缓存来确定是否可以使用缓存的副本而不必向服务器发出新的请求。
      1. 如果缓存有效，客户端可以直接从缓存中获取响应，减少了网络延迟和带宽消耗。	
      2. 如果缓存失效，客户端必须向服务器发送新的请求，并将新的响应存储在缓存中以供将来使用。
   5. 分布式缓存解决热点数据问题
      1. 单机全量缓存 + 主从
      2. 分布式缓存 + 应用本地热点
      3. 实时热点发现系统
3. 连接池
   1. 数据库连接池
   2. HttpClient连接池
   3. 线程池
      1. Java线程池
      2. Tomcat线程池
4. 异步并发
   1. 异步并发是指在程序执行过程中，同时处理多个任务或操作，而无需等待每个任务完成后再进行下一个任务。异步并发的主要目的是提高程序的效率和响应性。
5. 扩容
   1. 单体应用垂直扩容
   2. 单体应用水平扩容
6. 队列
   1. 异步处理
   2. 系统解耦
   3. 数据同步
   4. 流量削峰
   5. 缓冲队列
   6. 任务队列
   7. 消息队列
