---
layout: post
title: 嵌入式开发
categories: [cate1, cate2]
description: some word here
keywords: keyword1, keyword2
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---

# 嵌入式开发——ROS入门

## 1. RTOS应用程序设计模式

嵌入式系统中的实时操作系统：需要高度可靠，高效的设计模式

1. 任务模式（Tasking Pattern）：RTOS中最基本的设计模式是任务模式，通过将系统功能分解为多个独立的任务来实现并发执行。每个任务独立运行，拥有自己的优先级和调度策略，并通过消息传递或共享资源进行通信和同步。
2. 时间片轮转调度（Round-Robin Scheduling）：这是一种常见的调度策略，其中每个任务按照一定的时间片轮流执行。当时间片用完后，任务被暂停，并将控制权转移到下一个任务上，以实现公平的任务调度。
3. 信号量模式（Semaphore Pattern）：信号量是一种用于实现任务同步和互斥的标识。通过使用信号量，任务可以等待特定条件的发生，或者获取对共享资源的独占访问权。
4. 事件标志模式（Event Flag Pattern）：事件标志是用于任务间通信的一种机制。它们用于表示系统中发生的特定事件，并允许任务等待、等待多个事件的组合或触发事件。
5. 管道和消息队列模式（Pipe and Message Queue Pattern）：这些模式用于实现任务间的异步通信。任务可以通过管道或消息队列发送和接收消息，以实现解耦和灵活的任务通信。
6. 定时器模式（Timer Pattern）：定时器是一种常见的RTOS功能，用于在预定的时间间隔内触发特定的操作。任务可以使用定时器来实现周期性任务、超时处理和定时事件触发。
7. 内存管理模式（Memory Management Pattern）：由于嵌入式设备的资源有限，有效的内存管理对于RTOS至关重要。这包括静态内存分配、动态内存

同步的模式：资源同步，活动同步

### 资源同步（Resource Synchronization）是指在多个任务或线程之间共享资源时，确保对资源的访问和操作按照特定的顺序进行，以避免数据竞争和不确定的结果。资源同步的目标是保证数据的一致性和正确性。

常见的资源同步机制包括：【课堂：中断锁定，抢占锁定，互斥锁】

1. 互斥锁（Mutex）：互斥锁用于保护共享资源，一次只允许一个任务或线程访问资源。当一个任务获取了互斥锁后，其他任务必须等待锁被释放才能访问资源。不会禁用中断，不会禁用内核的抢占调度程序。
2. 信号量（Semaphore）：信号量用于控制对一组资源的访问。它可以用来限制资源的数量或者用于任务间的同步和通信。
3. 条件变量（Condition Variable）：条件变量用于在任务间进行条件等待和通知。一个或多个任务可以等待某个条件满足，当条件满足时，其他任务可以通过发送信号或广播通知等方式唤醒等待任务。
4. 中断锁：基本原理是在进入关键代码区域之前，禁用中断；在离开关键代码区域时，重新启用中断。这样，即使发生中断，由于中断被禁用，中断处理程序将暂时无法运行，直到关键代码区域执行完毕并重新启用中断。
5. 抢占锁：任务在进入关键代码区域之前获取抢占锁，如果抢占锁被持有，则任务不可被抢占，直到任务释放抢占锁后，其他更高优先级的任务才有机会抢占执行。

### 活动同步（Activity Synchronization）是指在RTOS中多个任务或线程之间进行协调和同步，以确保它们按照特定的顺序执行或按照特定的时间要求进行活动。活动同步的目标是保证系统中的活动按照预期的顺序和时序进行。

常见的活动同步机制包括：

1. 事件标志（Event Flag）：事件标志用于在任务间通知和等待特定事件的发生。每个事件都可以使用一个标志位表示，任务可以等待一个或多个事件的组合。
2. 信号量（Semaphore）：信号量在活动同步中也起到重要的作用，可以用于任务间的同步和通信。
3. 消息队列（Message Queue）：消息队列用于在任务间传递消息，在活动同步中可以用于任务之间的协调和同步。

### 单向同步：

### （任务对任务）

单项同步使用二值信号量或事件标志来同步任务

### （中断到任务）

单项同步还可以在中断和任务之间同步和协调任务执行，在ISR给出信号量或事件标志之后，ISR讲继续执行，直到完成为止

### 双向同步：

两个任务在它们之间的两个方向上进行协调

### 同步多个任务之广播设计模式

允许多个任务阻塞，直到给定信号量，出现事件标志，甚至将消息放入消息队列。要检查RTOS是否支持。若不支持广播可以创建由任务或中断给出的多个信号量。（不是很优雅，尽量别用）

### 发布和订阅模型

在物联网领域广泛使用，是非常灵活的一种形式

有一个代理，类似于服务器。缺点是会导致营养程序占用更大的内存

在发布-订阅模式中，消息的发送者（发布者）将消息发布到一个或多个主题（也称为通道或主题），而消息的接收者（订阅者）则通过订阅特定的主题来接收消息。发布者和订阅者之间不直接通信，而是通过主题进行中介，从而实现了解耦。

### 低功耗应用程序设计模式

主要模式是尽可能保持设备关闭

尤其是使用电池供电

事件驱动中，事件之间没有实际工作要做时，应该将微控制器置于适当的低功耗状态，并关闭非必要的电子设备。除非发生唤醒事件，否则系统处于低功耗状态，实际工作完成后，系统恢复到低功耗状态。

建议：使用内置tickless模式的RTOS。一个例子：当系统进行睡眠状态时，系统节拍被自动缩放，因此发生的系统节拍更少

### 多核架构

同构多核：对称多核处理具有相同处理器架构的两个核

异构多核架构：每个处理核心都有不同的底层架构

是指计算机系统中具有多个独立处理核心（CPU核心）的架构。每个处理核心都可以独立执行指令流，并具有自己的寄存器组、缓存和执行单元。

例子；人工智能用例，一个核心用于运行极其学习推理，另一个核心用于实时控制。

实时控制用例：

安全解决方案用例：

## 2. ROS核心概念

### 节点Nodes 

单一用途的可执行程序

使用ROS客户端库进行编写，c++

单独编译，执行和管理

节点可以发布或订阅Topic，也可以提供或使用服务或行动

### 节点管理器ROS Master 

为各节点提供链接信息，以便个节点之间互通信息（它也是一个节点）

提供和记录主题/服务通信，辅助节点相互查找、建立连接

提供参数服务器，节点使用此服务器存储和检索运行时的参数

ROS_MASTER_URI

### 消息和主题Messages and Topics 

主题：已定义类型的命名消息流。节点之间通过向主题发布消息彼此通信

消息：用于节点间通信的严格类型的数据结构

### 服务Services 



### 动作action 

与服务类似，动作客户端向动作服务器发送请求以实现某些目标并获得结果。动作服务器会向动作客户端发送进度反馈消息

动作实体：一个动作服务器，一个动作客户端

动作是异步的

### 参数Parameters 

参数服务器：

可通过网络访问的共享的多变量字典 

节点使用此服务器来存储和检索运行时的参数；

 适合存储静态、非二进制的配置参数，不适合存储动态配置 的数据

### 包Packages、栈Stacks、Meta Packages

ROS中的软件以包的形式组织

包的目标是创建易于重用的最小代码的集合

一个包包含一个或多个节点，文档，并提供ROS接口

ROS功能包的结构

![截屏2023-10-30 11.36.06](https://github.com/ShadowOnYOU/images/blob/main/test202310301136756.png?raw=true)

一个包应该是一个独立的单元，仅有一个目的，使用真正的最小依赖，不要创建循环依赖

ROS中的包被组织到ROS栈中 

栈的目标是简化代码共享过程。

栈是ROS中用于分发软件的 主要机制 ROS Navigation Stack是ROS提供的一个二维的导航功能包集合

Meta packages: 该meta package是指由特定目的组成的 一个包集合，替代Stack

## 3. 常见ROS命令

ROSshell命令、 ROS执行命令、ROS信息命令、ROS catkin命令与ROS功 能包命令

![截屏2023-10-30 11.45.07](https://github.com/ShadowOnYOU/images/blob/main/test202310301145494.png?raw=true)

![截屏2023-10-30 11.45.48](https://github.com/ShadowOnYOU/images/blob/main/test202310301145607.png?raw=true)

![截屏2023-10-30 11.46.29](https://github.com/ShadowOnYOU/images/blob/main/test202310301146979.png?raw=true)

![截屏2023-10-30 11.46.53](https://github.com/ShadowOnYOU/images/blob/main/test202310301146417.png?raw=true)

![截屏2023-10-30 11.47.13](https://github.com/ShadowOnYOU/images/blob/main/test202310301147340.png?raw=true)

![截屏2023-10-30 11.47.33](https://github.com/ShadowOnYOU/images/blob/main/test202310301147299.png?raw=true)

编队

