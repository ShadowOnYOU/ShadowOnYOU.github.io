---
layout: post
title: 嵌入式阶段整理
categories: [cate1, cate2]
description: some word here
keywords: keyword1, keyword2
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---

# 嵌入式阶段整理

## 1. 嵌入式系统概论

嵌入式软件开发：产品增值，越来越复杂

本课程介绍：定义，基础知识，支撑技术，掌握嵌入式系统设计过程，重点在于嵌入式软件的开发

## 2. 嵌入式系统概述

### 2.1 术语

泛在计算：预言任何时间、任何地点的计算

不可见计算机：预言计算机将被集成到物件中

普适计算：计算设备对日常生活的渗透

环境智能：强调未来家庭货智能楼宇中的通信技术

### 2.2 嵌入式系统概念

“嵌入式计算机系统”

嵌入式系统是“用于控制、监视或者辅助操作机器和设备”的装置。嵌入式系统是软件和硬件的综合体

国内定义：嵌入式系统是“以应用为中心，以计算机技术为基础，软硬件可裁剪，适用于应用系统对功能、可靠性、成本、体积、功耗有严格要求的专用计算机系统”

其他：嵌入封闭产品中的信息处理系统；包含有计算机，但又不是通用计算机的计算应用系统

### 2.3 嵌入式系统三要素

1. 嵌入性：嵌入到对象体系中，有对象环境要求
2. 专用性：软、硬件按对象要求设计、裁剪
3. 计算机：实现对象的智能化功能

### 2.4 嵌入式系统的组成

一般由嵌入式硬件和软件组成

硬件以微处理器为核心集成存储器和系统专用的输入/输出设备

软件包括初始化代码及驱动、嵌入式操作系统和应用程序等

### 2.5 通用计算机与嵌入式系统的区别

![截屏2023-10-23 08.39.11](https://github.com/ShadowOnYOU/images/blob/main/test202310230839797.png?raw=true)

### 2.6 嵌入式系统的特点

1. 形式多样，面向特定应用的
2. 得到多种类型的处理器和处理器体系结构的支持
3. 极其关注成本
4. 有实时性和可靠性的要求
5. 操作系统一般是适应多种处理器、可剪裁、轻量型，实时可靠，可固化的嵌入式操作系统
6. 需要专门的工具和特殊方法

### 2.7 嵌入式系统的分类

1. 按嵌入式处理器的位数
2. 按应用
3. 按速度
4. 按确定性
5. 按嵌入式系统软件复杂程度

## 3. ROS简介

### 3.1 什么是ROS

ROS是一个适用于机器人的开源的元操作系统。提供了操作系统应有的服务，包括硬件抽象、底层设备控制、常用函数的实现、进程间消息传递以及包的管理。也提供了用于获取、编译、编写和跨计算机运行代码所需的工具和库函数。

### 3.2 管道

ROS的核心是一个提供消息传递系统——“中间件”或“管道”

ROS的消息传递系统通过匿名发布/订阅模式管理分布式节点之间的通信细节，从而节省时间。

在ROS中，节点可以通过发布者（Publisher）将消息发布到特定的主题（Topic），而其他节点可以通过订阅者（Subscriber）来接收这些消息。发布者和订阅者之间是匿名的，它们不需要显式地知道彼此的存在。这种匿名性使得节点之间的通信解耦，从而节省了时间和精力。

### 3.3 ROS文件系统级

![截屏2023-10-23 08.56.08](https://github.com/ShadowOnYOU/images/blob/main/test202310230856651.png?raw=true)

1. 综合功能包：综合功能包将特定应用程序包的列表组合在一起。例如，在ROS中，有一个称为导航(navigation)的综合功能包用于移动机器人导航。它可以保存相关功能包的信息，并有助于在自己的安装过程中安装这些功能包。

2. 功能包:ROS 软件主要以ROS功能包的形式组织。可以说ROS功能包是ROS的元构建单元。一个功能包的单个模块中可能包括ROS节点/进程、数据集和配置文件。
3. 功能包清单:每个包都有一个名为package.xml的清单文件。该文件包括包的名称、 版本、作者、许可证和依赖项等信息。综合功能包的package.xml文件由相关功能包的名称组成。
4. 消息(msg):ROS通过发送ROS消息进行通信。可以在具有.msg扩展名的文件中定义消息数据的类型。这些文件称为消息文件。按照约定，消息文件保存在 our_package/msg/message_files.msg下。
5. 服务(srv):计算图级概念之一是服务。与ROS消息类似，约定服务定义放在our_package/srv/ service_files.srv 下。

### 3.4 ROS计算图级

![截屏2023-10-23 09.01.28](https://github.com/ShadowOnYOU/images/blob/main/test202310230901283.png?raw=true)

1. 节点：ROS节点是一个使用ROS API进行通信的进程
2. 节点管理器：ROS节点管理器作为一个中间节点，用于在不同的ROS节点之间建立连接。节点管理器具有ROS环境中运行的所有节点的全部细节。他将与另一个节点交换细节，建立它们之间的连接。交换信息后，这两个ROS节点将开始通信。
3. 参数服务器：节点可以在参数服务器中存储变量，并设置其私有属性。若具有全局性，则可以由其他所有节点访问。ROS参数与ROS节点管理器一起运行。
4. 消息：ROS节点可以通过多种方式相互通信。在所有方法中，节点以ROS消息的形式发送和接受数据，ROS消息是ROS节点用于交换数据的数据结构。
5. 主题：ROS主题是两个ROS节点之间通信和交换ROS信息的方法之一。主题是命名的总线，使用ROS消息交换数据。每个主题都有一个特定的名称，一个节点会将数据发布到主题，另一个节点可以通过订阅从主题中读取。
6. 服务：服务是不同于主题的另一种通信方式。主题使用发布或订阅通信，但在服务中，使用的是请求或回复方式。一个节点将作为服务提供者，运行服务历程，客户端节点可以从服务器节点请求服务。服务器将执行服务程序并将结果发送给客户端。客户端节点等待服务器响应结果。
7. 消息记录包：ROS中用于录制和播放ROS主题的工具。

### 3.5 catkin软件包组成

1. 这个包必须有一个符合catkin规范的package.xml文件

2. 这个package.xml文件提供有关该软件包的元信息

3. 这个包必须有一个catkin版本的CMakeLists.txt文件

4. 如果它是个Catkin元包的话，则需要有一个CMakeList.txt文件的相关样板

5. 每个包必须有自己的目录

6. 这意味着在同一个目录下不能有嵌套的或者多个软件包存在

## 4. 嵌入式系统设计方法

### 4.1 嵌入式系统面临的挑战

时限要求，降低功耗，系统可升级，系统可靠性

软件设计的需求：实时，低功耗，代码量小

### 4.2 嵌入式系统的设计过程

![截屏2023-10-23 09.22.59](https://github.com/ShadowOnYOU/images/blob/main/test202310230923925.png?raw=true)

![截屏2023-10-23 09.24.06](https://github.com/ShadowOnYOU/images/blob/main/test202310230924157.png?raw=true)

V模型

![截屏2023-10-23 09.24.43](https://github.com/ShadowOnYOU/images/blob/main/test202310230924144.png?raw=true)

### 4.3 嵌入式系统设计方法学

体系结构设计：必须考虑功能性和非功能性需求

软硬件的划分：嵌入式系统的设计涉及硬件与软件部件，设计中必须决定什么功能由硬件实现，什么功能由软件实现。

通常由软件实现的部分：操作系统功能（任务调度，资源管理，设备驱动），协议栈，应用软件框架。除基本系统、物理接口、基本逻辑电路，许多由硬件实现的功能都可以由软件实现。

软硬件设计的趋势——融合渗透，协同设计（增加了灵活性，增加了风险）

HW/SW Co-design：软硬件协同设计

是指设计一种特殊用途系统，该系统由一些特定应用的集成电路与处理器上的软件程序协同工作而组成。协同设计是指通过并行设计利用硬件和软件的协同作用来实现系统级目标。协同设计视图通过提供分析方法来增加嵌入式系统设计的可预测性。![截屏2023-10-23 09.34.14](https://github.com/ShadowOnYOU/images/blob/main/test202310230934298.png?raw=true)

## 5. 嵌入式微处理器

### 5.1 主流的微处理器

1. ARM
2. MIPS（无互锁流水级的微处理器）
3. PowerPC
4. X86

### 5.2 冯诺依曼结构 && 哈佛结构

冯诺依曼：将程序指令存储器和数据存储器合并在一起的存储器结构。程序指令存储位置和数据存储地址指向同一个存储器的不同物理位置，因此程序指令和数据的宽度相同

哈佛结构：使用两个独立的存储器模块，分别存储指令和数据。使用独立的两条总线，分别作为CPU与每个存储器之间的专用通信路径，而这两条总线之间毫无关联。

改进的哈佛：具有一条独立的地址总线和一条独立的数据总线，利用公用地址总线访问两个存储模块（程序存储模块和数据存储模块），公用数据总线则被用来完成程序存储模块或数据存储模块与CPU之间的数据传输；两条总线由程序存储器和数据存储器分时共用。（大多数DSP（数字信号处理）使用）

### 5.3 RISC && CISC

CISC：复杂指令集计算机（多种寻址模式）

RISC：精简指令集计算机（流水线指令）

![截屏2023-10-23 14.07.37](https://github.com/ShadowOnYOU/images/blob/main/test202310231407520.png?raw=true)

考虑的事情：成本，生态系统，碎片化风险，安全性，设计保证

### 5.4 嵌入式微处理器的分类

1. 嵌入式微处理单元 MPU
   1. 嵌入式微处理器就是和通用计算机的处理器对应的CPU
   2. 体积小，功耗高，成本低，可靠性高
2. 嵌入式微控制器 MCU
   1. 嵌入式微控制器就是将整个计算机系统的主要硬件集成到一块芯片中，芯片内部集成RAM，总线等各种必要功能和外设。
   2. 单片化，体积大大减小，功耗和成本降低，可靠性提高
   3. 是目前嵌入式工业的主流，占约50%的份额
3. 嵌入式DSP处理器
   1. 专门用于信号处理方面的处理器，其在系统结构个指令算法方面进行了特殊设计，有很高的编译效率和指令执行速度
4. 嵌入式SoC
   1. 是追求产品系统最大包容的集成器件。绝大多数系统构建都在一个系统芯片内部
   2. 可以有效的降低电子/信息系统产品的开发成本，缩短开发周期，提高产品的竞争力
   3. 结构简洁，体积小，可靠性高，设计生产效率高

**特点**：

1. 基础是通用微处理器
2. 与通用微处理器相比：
   1. 体积小，重量轻，可靠性高
   2. 功耗低
   3. 成本低：片上存储、引脚与封装、代码密度
   4. 工作温度、抗电磁干扰、可靠性增强

### 5.5 ARM公司

#### ARM处理器的分类

1. 应用处理器
   1. 最高的性能，优化了丰富的操作系统
2. 实时控制处理器
   1. 快速响应，针对高性能、硬实时应用程序进行了优化
3. 微控制器
   1. 最小/最低功率，优化离散处理和微控制器
4. SecureCore
   1. 防篡改，针对安全应用程序进行了优化

#### 典型的RISC结构

1. 丰富的寄存器
2. 加载/存储体系结构
3. 简单寻址模式
4. 统一和固定长度的指令字段

增强功能：

1. 每条指令控制ALU和位移器
2. 自动递增和自动递减寻址模式
3. 多个加载/存储
4. 条件执行

#### 选择微处理器的步骤

1. 列出需要的硬件接口
2. 检查软件架构
3. 选择体系结构
4. 确定内存需求
5. 开始搜索微控制器
6. 检查成本和功率限制
7. 检查零件的可用性
8. 选择一个开发工具包
9. 研究编译器和工具
10. 开始尝试

## 6. 存储器架构

### 6.1 存储系统

对许多应用来说，存储系统对整个系统性能的影响比对数据流水线的影响更大

在同一个嵌入式系统中，通常需要组合各种存储技术

层次结构往往是必须的

处理器架构的地址空间被分解成若干子空间来提供不同类型的存储器访问

#### 易失性存储器

断电时内容消失

随机存取存储器 RAM

SRAM：

1. 静态RAM，SRAM，速度快面积大

2. 动态RAM，DARM，保持数据的事件很短，需要定期刷新，比SRAM更不稳定

大多数嵌入式系统都包括一个SRAM，许多ES也会包括DRAM：因为只用SRAM不能提供足够大的存储容量

#### 非易失性存储器

不需要持续供电来保留存储在计算设备中的数据或程序代码

1. 只读存储器 ROM：内容在芯片工厂就已经固定
2. 电可擦除可编程ROM （EEPROM）
3. 快闪存储器 FLASH
   1. 有较快的读取时间但比SRAM和DRAM慢
      1. 频繁访问的数据在程序使用之前从flash转移到RAM中
   2. 写入时间大大超过读取时间，而且写入的次数是有限的
4. 磁盘存储器

### 6.2 存储器层次结构

1. 处理器寄存器
2. 工作存储器（主存储器、主存）。易失的
3. 缓冲存储器：高速缓存
4. flash、磁盘等非易失性存储

### 6.3 cache

高速缓存的架构对应用程序的执行时间具有很大印象概念股

高速缓存潜在的提高了存储系统的能效

在设计师预测缓存是否命中是很困难的，并且这对实时性能的精确预测而言也是一个负担

## 7. 基于总线的计算机系统

### 7.1 输入与输出

#### IO接口与设备

数据寄存器，控制寄存器，状态寄存器

#### 分类

从属关系：系统设备，用户设备

使用：专用设备，共享设备，虚拟设备

特征：存储设备，IO设备

信息传输单元：块设备，字符设备

#### 竞态条件

设备活系统出现不恰当的执行时序，而得到不正确的结果

### 7.2 总线

一组传送线路 + 相关的通信协议

// 第一阶段整理到PPT6.1
